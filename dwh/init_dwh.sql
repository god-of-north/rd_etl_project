DROP DATABASE rd_dwh;

CREATE DATABASE rd_dwh ENCODING 'UTF8';

ALTER DATABASE rd_dwh OWNER TO gpuser;

\connect rd_dwh

DROP TABLE fact_out_of_stock;
DROP TABLE fact_orders;
DROP TABLE dim_date;
DROP TABLE dim_products;
DROP TABLE dim_clients;
DROP TABLE dim_stores;
DROP TABLE dim_area;



CREATE TABLE dim_date(
	action_date date PRIMARY KEY,
	action_day int not NULL,
	action_month int not NULL,
	action_year int not NULL,
	action_weekday varchar(3) not NULL
);

CREATE TABLE dim_products(
	product_id int PRIMARY KEY,
	product_name int,
	department_name varchar(127),
	aisle varchar(127)
);

CREATE TABLE dim_area(
	area_id int PRIMARY KEY,
	area varchar(64)
);

CREATE TABLE dim_clients(
	client_id int PRIMARY KEY,
	fullname varchar(64),
	area_id int
);

CREATE TABLE dim_stores(
	store_id int PRIMARY KEY,
	area_id int,
	type varchar(64)
);

CREATE TABLE fact_orders(
	product_id int,
	client_id int,
	store_id int,
	order_date date,
	quantity int,
	CONSTRAINT pkey_orders PRIMARY KEY(product_id, client_id, store_id, order_date)
);

CREATE TABLE fact_out_of_stock(
	product_id int,
	oos_date date,
	CONSTRAINT pkey_oos PRIMARY KEY(product_id, oos_date)
);

COPY dim_date (action_date, action_day, action_month, action_year, action_weekday) FROM stdin;
2021-01-01	2021	01	01	Fri
2021-01-02	2021	01	02	Sat
2021-01-03	2021	01	03	Sun
2021-01-04	2021	01	04	Mon
2021-01-05	2021	01	05	Tue
2021-01-06	2021	01	06	Wed
2021-01-07	2021	01	07	Thu
2021-01-08	2021	01	08	Fri
2021-01-09	2021	01	09	Sat
2021-01-10	2021	01	10	Sun
2021-01-11	2021	01	11	Mon
2021-01-12	2021	01	12	Tue
2021-01-13	2021	01	13	Wed
2021-01-14	2021	01	14	Thu
2021-01-15	2021	01	15	Fri
2021-01-16	2021	01	16	Sat
2021-01-17	2021	01	17	Sun
2021-01-18	2021	01	18	Mon
2021-01-19	2021	01	19	Tue
2021-01-20	2021	01	20	Wed
2021-01-21	2021	01	21	Thu
2021-01-22	2021	01	22	Fri
2021-01-23	2021	01	23	Sat
2021-01-24	2021	01	24	Sun
2021-01-25	2021	01	25	Mon
2021-01-26	2021	01	26	Tue
2021-01-27	2021	01	27	Wed
2021-01-28	2021	01	28	Thu
2021-01-29	2021	01	29	Fri
2021-01-30	2021	01	30	Sat
2021-01-31	2021	01	31	Sun
2021-02-01	2021	02	01	Mon
2021-02-02	2021	02	02	Tue
2021-02-03	2021	02	03	Wed
2021-02-04	2021	02	04	Thu
2021-02-05	2021	02	05	Fri
2021-02-06	2021	02	06	Sat
2021-02-07	2021	02	07	Sun
2021-02-08	2021	02	08	Mon
2021-02-09	2021	02	09	Tue
2021-02-10	2021	02	10	Wed
2021-02-11	2021	02	11	Thu
2021-02-12	2021	02	12	Fri
2021-02-13	2021	02	13	Sat
2021-02-14	2021	02	14	Sun
2021-02-15	2021	02	15	Mon
2021-02-16	2021	02	16	Tue
2021-02-17	2021	02	17	Wed
2021-02-18	2021	02	18	Thu
2021-02-19	2021	02	19	Fri
2021-02-20	2021	02	20	Sat
2021-02-21	2021	02	21	Sun
2021-02-22	2021	02	22	Mon
2021-02-23	2021	02	23	Tue
2021-02-24	2021	02	24	Wed
2021-02-25	2021	02	25	Thu
2021-02-26	2021	02	26	Fri
2021-02-27	2021	02	27	Sat
2021-02-28	2021	02	28	Sun
2021-03-01	2021	03	01	Mon
2021-03-02	2021	03	02	Tue
2021-03-03	2021	03	03	Wed
2021-03-04	2021	03	04	Thu
2021-03-05	2021	03	05	Fri
2021-03-06	2021	03	06	Sat
2021-03-07	2021	03	07	Sun
2021-03-08	2021	03	08	Mon
2021-03-09	2021	03	09	Tue
2021-03-10	2021	03	10	Wed
2021-03-11	2021	03	11	Thu
2021-03-12	2021	03	12	Fri
2021-03-13	2021	03	13	Sat
2021-03-14	2021	03	14	Sun
2021-03-15	2021	03	15	Mon
2021-03-16	2021	03	16	Tue
2021-03-17	2021	03	17	Wed
2021-03-18	2021	03	18	Thu
2021-03-19	2021	03	19	Fri
2021-03-20	2021	03	20	Sat
2021-03-21	2021	03	21	Sun
2021-03-22	2021	03	22	Mon
2021-03-23	2021	03	23	Tue
2021-03-24	2021	03	24	Wed
2021-03-25	2021	03	25	Thu
2021-03-26	2021	03	26	Fri
2021-03-27	2021	03	27	Sat
2021-03-28	2021	03	28	Sun
2021-03-29	2021	03	29	Mon
2021-03-30	2021	03	30	Tue
2021-03-31	2021	03	31	Wed
2021-04-01	2021	04	01	Thu
2021-04-02	2021	04	02	Fri
2021-04-03	2021	04	03	Sat
2021-04-04	2021	04	04	Sun
2021-04-05	2021	04	05	Mon
2021-04-06	2021	04	06	Tue
2021-04-07	2021	04	07	Wed
2021-04-08	2021	04	08	Thu
2021-04-09	2021	04	09	Fri
2021-04-10	2021	04	10	Sat
2021-04-11	2021	04	11	Sun
2021-04-12	2021	04	12	Mon
2021-04-13	2021	04	13	Tue
2021-04-14	2021	04	14	Wed
2021-04-15	2021	04	15	Thu
2021-04-16	2021	04	16	Fri
2021-04-17	2021	04	17	Sat
2021-04-18	2021	04	18	Sun
2021-04-19	2021	04	19	Mon
2021-04-20	2021	04	20	Tue
2021-04-21	2021	04	21	Wed
2021-04-22	2021	04	22	Thu
2021-04-23	2021	04	23	Fri
2021-04-24	2021	04	24	Sat
2021-04-25	2021	04	25	Sun
2021-04-26	2021	04	26	Mon
2021-04-27	2021	04	27	Tue
2021-04-28	2021	04	28	Wed
2021-04-29	2021	04	29	Thu
2021-04-30	2021	04	30	Fri
2021-05-01	2021	05	01	Sat
2021-05-02	2021	05	02	Sun
2021-05-03	2021	05	03	Mon
2021-05-04	2021	05	04	Tue
2021-05-05	2021	05	05	Wed
2021-05-06	2021	05	06	Thu
2021-05-07	2021	05	07	Fri
2021-05-08	2021	05	08	Sat
2021-05-09	2021	05	09	Sun
2021-05-10	2021	05	10	Mon
2021-05-11	2021	05	11	Tue
2021-05-12	2021	05	12	Wed
2021-05-13	2021	05	13	Thu
2021-05-14	2021	05	14	Fri
2021-05-15	2021	05	15	Sat
2021-05-16	2021	05	16	Sun
2021-05-17	2021	05	17	Mon
2021-05-18	2021	05	18	Tue
2021-05-19	2021	05	19	Wed
2021-05-20	2021	05	20	Thu
2021-05-21	2021	05	21	Fri
2021-05-22	2021	05	22	Sat
2021-05-23	2021	05	23	Sun
2021-05-24	2021	05	24	Mon
2021-05-25	2021	05	25	Tue
2021-05-26	2021	05	26	Wed
2021-05-27	2021	05	27	Thu
2021-05-28	2021	05	28	Fri
2021-05-29	2021	05	29	Sat
2021-05-30	2021	05	30	Sun
2021-05-31	2021	05	31	Mon
2021-06-01	2021	06	01	Tue
2021-06-02	2021	06	02	Wed
2021-06-03	2021	06	03	Thu
2021-06-04	2021	06	04	Fri
2021-06-05	2021	06	05	Sat
2021-06-06	2021	06	06	Sun
2021-06-07	2021	06	07	Mon
2021-06-08	2021	06	08	Tue
2021-06-09	2021	06	09	Wed
2021-06-10	2021	06	10	Thu
2021-06-11	2021	06	11	Fri
2021-06-12	2021	06	12	Sat
2021-06-13	2021	06	13	Sun
2021-06-14	2021	06	14	Mon
2021-06-15	2021	06	15	Tue
2021-06-16	2021	06	16	Wed
2021-06-17	2021	06	17	Thu
2021-06-18	2021	06	18	Fri
2021-06-19	2021	06	19	Sat
2021-06-20	2021	06	20	Sun
2021-06-21	2021	06	21	Mon
2021-06-22	2021	06	22	Tue
2021-06-23	2021	06	23	Wed
2021-06-24	2021	06	24	Thu
2021-06-25	2021	06	25	Fri
2021-06-26	2021	06	26	Sat
2021-06-27	2021	06	27	Sun
2021-06-28	2021	06	28	Mon
2021-06-29	2021	06	29	Tue
2021-06-30	2021	06	30	Wed
2021-07-01	2021	07	01	Thu
2021-07-02	2021	07	02	Fri
2021-07-03	2021	07	03	Sat
2021-07-04	2021	07	04	Sun
2021-07-05	2021	07	05	Mon
2021-07-06	2021	07	06	Tue
2021-07-07	2021	07	07	Wed
2021-07-08	2021	07	08	Thu
2021-07-09	2021	07	09	Fri
2021-07-10	2021	07	10	Sat
2021-07-11	2021	07	11	Sun
2021-07-12	2021	07	12	Mon
2021-07-13	2021	07	13	Tue
2021-07-14	2021	07	14	Wed
2021-07-15	2021	07	15	Thu
2021-07-16	2021	07	16	Fri
2021-07-17	2021	07	17	Sat
2021-07-18	2021	07	18	Sun
2021-07-19	2021	07	19	Mon
2021-07-20	2021	07	20	Tue
2021-07-21	2021	07	21	Wed
2021-07-22	2021	07	22	Thu
2021-07-23	2021	07	23	Fri
2021-07-24	2021	07	24	Sat
2021-07-25	2021	07	25	Sun
2021-07-26	2021	07	26	Mon
2021-07-27	2021	07	27	Tue
2021-07-28	2021	07	28	Wed
2021-07-29	2021	07	29	Thu
2021-07-30	2021	07	30	Fri
2021-07-31	2021	07	31	Sat
2021-08-01	2021	08	01	Sun
2021-08-02	2021	08	02	Mon
2021-08-03	2021	08	03	Tue
2021-08-04	2021	08	04	Wed
2021-08-05	2021	08	05	Thu
2021-08-06	2021	08	06	Fri
2021-08-07	2021	08	07	Sat
2021-08-08	2021	08	08	Sun
2021-08-09	2021	08	09	Mon
2021-08-10	2021	08	10	Tue
2021-08-11	2021	08	11	Wed
2021-08-12	2021	08	12	Thu
2021-08-13	2021	08	13	Fri
2021-08-14	2021	08	14	Sat
2021-08-15	2021	08	15	Sun
2021-08-16	2021	08	16	Mon
2021-08-17	2021	08	17	Tue
2021-08-18	2021	08	18	Wed
2021-08-19	2021	08	19	Thu
2021-08-20	2021	08	20	Fri
2021-08-21	2021	08	21	Sat
\.
